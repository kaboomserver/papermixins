package pw.kaboom.papermixins.mixin.fix.exploit.oversized_component;

import com.llamalad7.mixinextras.injector.wrapoperation.Operation;
import com.llamalad7.mixinextras.injector.wrapoperation.WrapOperation;
import io.netty.handler.codec.EncoderException;
import net.minecraft.network.SkipPacketEncoderException;
import net.minecraft.network.Varint21LengthFieldPrepender;
import org.spongepowered.asm.mixin.Mixin;
import org.spongepowered.asm.mixin.injection.At;

@Mixin(Varint21LengthFieldPrepender.class)
public abstract class Varint21LengthFieldPrependerMixin {
    @WrapOperation(method = "encode(Lio/netty/channel/ChannelHandlerContext;Lio/netty/buffer/ByteBuf;" +
        "Lio/netty/buffer/ByteBuf;)V",
        at = @At(value = "NEW", target = "(Ljava/lang/String;)Lio/netty/handler/codec/EncoderException;"))
    private EncoderException encode$throw(final String message, final Operation<EncoderException> original) {
        return new SkipPacketEncoderException(message);
    }
}
